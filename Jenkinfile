pipeline{
    agent any

    tools {
         maven 'maven'
         jdk 'java'
    }
    environment {
        CREDENTIALS_ID ='o-media-2'
        BUCKET = 'gcp-dev12'
        PATTERN = '.jar'
    }

    stages{
      //  stage('checkout'){
         //   steps{
            //    checkout([$class: 'GitSCM', branches: [[name: '*/master']], extensions: [], userRemoteConfigs: [[credentialsId: 'github access', url: 'https://github.com/sreenivas449/java-hello-world-with-maven.git']]])
            //}
        //}
        stage('build'){
            steps{
               sh 'mvn clean install'
            }
            }
 
        stage('Store to GCS') {
            steps{
                sh '''
                    env > /var/lib/jenkins/workspace/storage-upload-arti/target/maigolab_hello-1.0.0.jar
                '''
                // If we name pattern build_environment.txt, this will upload the local file to our GCS bucket.
                step([$class: 'ClassicUploadStep', credentialsId: env
                        .CREDENTIALS_ID,  bucket: "gs://${env.BUCKET}",
                      pattern: env.PATTERN])
               }
           }
           }
        }
   


